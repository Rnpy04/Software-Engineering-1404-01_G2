{% extends "team6/base.html" %}{% load notification_tags %}
{% block title %}{{ article.title_fa }}{% endblock %}

{% block content %}

<style>
    .article-content-body a {
        color: #0066cc !important; /* Ø¢Ø¨ÛŒ Ú©Ù„Ø§Ø³ÛŒÚ© ÙˆÛŒÚ©ÛŒ */
        text-decoration: underline !important; /* Ø²ÛŒØ±Ø®Ø·â€ŒØ¯Ø§Ø± */
        font-weight: 500;
    }
    .article-content-body a:hover {
        color: #004080 !important;
        background-color: rgba(0, 102, 204, 0.05);
    }
    .back-btn {
        margin-bottom: 15px;
    }
</style>

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>{{ article.title_fa }}
        {% if article.title_en %}
            <small class="text-muted">({{ article.title_en }})</small>
        {% endif %}
    </h2>
    
    <button onclick="history.back()" class="btn btn-outline-secondary btn-sm back-btn">
        <i class="fa-solid fa-arrow-left"></i> Ø¨Ø§Ø²Ú¯Ø´Øª
    </button>
</div>

<div class="mb-3 text-muted">
    <i class="fa-solid fa-folder"></i> Ø¯Ø³ØªÙ‡: {{ article.category.title_fa }} | 
    <i class="fa-solid fa-eye"></i> Ø¨Ø§Ø²Ø¯ÛŒØ¯: {{ article.view_count|default:0 }} |
    <i class="fa-solid fa-calendar"></i> ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯: {{ article.created_at|date:"Y/m/d" }}
</div>

<div class="card p-4 mb-4 article-content-body" style="border-right: 4px solid #4CAF50; line-height: 1.8; font-size: 1.1rem;">
    {{ article.body_fa|safe|linebreaks }}
</div>

<div class="d-flex gap-2 mb-4">
    {% if request.user.is_authenticated and article.author_user_id == request.user.id %}
        <a href="{% url 'team6:article_edit' article.slug %}" class="btn btn-warning">
            <i class="fa-solid fa-edit"></i> ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ù‚Ø§Ù„Ù‡
        </a>
        <a href="{% url 'team6:article_delete' article.slug %}" class="btn btn-danger">
            <i class="fa fa-trash"></i> Ø­Ø°Ù Ù…Ù‚Ø§Ù„Ù‡
        </a>
    {% endif %}
    
    <a href="{% url 'team6:article_revisions' article.slug %}" class="btn btn-info">
        <i class="fa-solid fa-history"></i> ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§
    </a>
    
    <a href="{% url 'team6:article_report' article.slug %}" class="btn btn-outline-danger">
        <i class="fa-solid fa-flag"></i> Ú¯Ø²Ø§Ø±Ø´ ØªØ®Ù„Ù
    </a>
    
    {% if request.user.is_authenticated %}
        {% with is_following=article|is_user_following:request.user notify_status=article|get_notify_status:request.user %}
            
            {% if is_following %}
                <form method="POST" action="{% url 'team6:toggle_notify' article.slug %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn {% if notify_status %}btn-warning{% else %}btn-outline-success{% endif %}">
                        <i class="fa-solid fa-bell{% if not notify_status %}-slash{% endif %}"></i>
                        {% if notify_status %}
                            ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§
                        {% else %}
                            ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§
                        {% endif %}
                    </button>
                </form>
                
                <form method="POST" action="{% url 'team6:article_follow' article.slug %}" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="unfollow">
                    <button type="submit" class="btn btn-outline-secondary">
                        <i class="fa-solid fa-user-minus"></i> Ù„ØºÙˆ Ø¯Ù†Ø¨Ø§Ù„ Ú©Ø±Ø¯Ù†
                    </button>
                </form>
                
            {% else %}
                <form method="POST" action="{% url 'team6:article_follow' article.slug %}" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="follow">
                    <button type="submit" class="btn btn-outline-success">
                        <i class="fa-solid fa-user-plus"></i> Ø¯Ù†Ø¨Ø§Ù„ Ú©Ø±Ø¯Ù† Ù…Ù‚Ø§Ù„Ù‡
                    </button>
                </form>
            {% endif %}
            
        {% endwith %}
    {% endif %}
</div>

<hr class="my-4">

<div class="card shadow-sm">
    <div class="card-header bg-light">
        <i class="fa-solid fa-info-circle"></i> Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÚ©Ù…ÛŒÙ„ÛŒ
    </div>
    <div class="card-body">
        <p><strong>Ù†Ø§Ù… Ù…Ú©Ø§Ù†:</strong> {{ article.place_name|default:"Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡" }}</p>
        <p><strong>Ø®Ù„Ø§ØµÙ‡ (AI):</strong> <span class="text-muted">{{ article.summary|default:"Ø®Ù„Ø§ØµÙ‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª" }}</span></p>
        
        {% if article.tags.all %}
        <div class="mt-2">
            <strong>ğŸ·ï¸ ØªÚ¯â€ŒÙ‡Ø§:</strong>
            {% for tag in article.tags.all %}
                <span class="badge bg-light text-dark border me-1">{{ tag.title_fa }}</span>
            {% endfor %}
        </div>
        {% endif %}
        
        <div class="mt-3 small text-muted">
            <p class="mb-1"><strong>Ø´Ù†Ø§Ø³Ù‡:</strong> {{ article.slug }}</p>
            <p class="mb-0"><strong>Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ‚ÛŒÙ…:</strong> <code>/team6/article/{{ article.slug }}/</code></p>
        </div>
    </div>
</div>

{% endblock %}